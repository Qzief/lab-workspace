<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifikasi Push Firebase | Aruf</title>
</head>
<body>
  <h2>🔔 Notifikasi Firebase Aktif</h2>
  <p>Klik tombol di bawah untuk aktifkan notifikasi browser.</p>
  <button id="activateNotif">Aktifkan Notifikasi</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-messaging-compat.js"></script>

  <script>
    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD9V0fG_bgxTcgcXQCfVLpvC-kjKeZBsiw",
      authDomain: "arufkuy-login-register.firebaseapp.com",
      projectId: "arufkuy-login-register",
      messagingSenderId: "334457785991",
      appId: "1:334457785991:web:a36fcfad9436c54f4b3222"
    };

    // Inisialisasi Firebase
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // Klik tombol untuk minta izin notif
    document.getElementById("activateNotif").addEventListener("click", async () => {
      try {
        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          alert("❌ Izin notifikasi ditolak.");
          return;
        }

        const registration = await navigator.serviceWorker.register('/lab-workspace/firebase-messaging-sw.js');
        messaging.useServiceWorker(registration);

        const token = await messaging.getToken({
          vapidKey: 'BKSYr7hRk2_CEPxzi1EOWghZlHE7DbF93dpqXzTK9D_TVYHuVCpA9dfSFr-j5jTPrBZa_ypq-E49pJz83hi3G5Y'
        });

        console.log("✅ Token FCM:", token);
        alert("🎉 Notifikasi diaktifkan!\nToken juga dicetak di console.");
      } catch (err) {
        console.error("❌ Error inisialisasi:", err);
      }
    });

    // Listener saat pesan diterima (ketika tab sedang terbuka)
    messaging.onMessage((payload) => {
      console.log("📩 Pesan diterima:", payload);
      const { title, body, icon } = payload.notification;
      new Notification(title, { body, icon });
    });
  </script>
</body>
</html>
