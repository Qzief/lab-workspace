<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifikasi Web (Desktop & Mobile)</title>
</head>
<body>
  <h2>Aktifkan Notifikasi</h2>
  <button id="btn-notif">Aktifkan Notifikasi</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-messaging-compat.js"></script>

  <script>
    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD9V0fG_bgxTcgcXQCfVLpvC-kjKeZBsiw",
      authDomain: "arufkuy-login-register.firebaseapp.com",
      projectId: "arufkuy-login-register",
      messagingSenderId: "334457785991",
      appId: "1:334457785991:web:a36fcfad9436c54f4b3222"
    };

    // Inisialisasi Firebase
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    async function initFirebaseMessagingRegistration() {
      try {
        // Cek dukungan notifikasi
        if (!("Notification" in window)) {
          alert("Browser kamu tidak mendukung notifikasi.");
          return;
        }

        // Cek dukungan service worker
        if (!('serviceWorker' in navigator)) {
          alert("Browser kamu tidak mendukung Service Worker.");
          return;
        }

        // Registrasi service worker
        const registration = await navigator.serviceWorker.register('./firebase-messaging-sw.js');
        console.log('‚úÖ Service Worker terdaftar:', registration);

        // Minta izin dari user
        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          alert('‚ùå Izin notifikasi ditolak.');
          return;
        }

        // Ambil token FCM
        const token = await messaging.getToken({
          vapidKey: 'BOx1zV8uVoHnK0chVKafBu6JsdkhCSgt6St1rDrtNiFeJySkIsCBeZEO_1Jehp6dkn-yZsKnEOAmFhREmKPTMIE',
          serviceWorkerRegistration: registration
        });

        console.log('Support check:', {
        sw: 'serviceWorker' in navigator,
        push: 'PushManager' in window,
        notif: 'Notification' in window,
        permission: Notification.permission
        });

        console.log('üéØ Token FCM:', token);

        // Simpan atau kirim token ke server (opsional)
        localStorage.setItem('fcm_token', token);

        // Tampilkan konfirmasi
        alert('üéâ Notifikasi berhasil diaktifkan! Token disimpan di localStorage.');

      } catch (err) {
        console.error('‚ùå Error inisialisasi:', err);
        alert('Gagal mengaktifkan notifikasi: ' + err.message);
      }
    }

    // Tombol klik (harus dari aksi user biar izin muncul di mobile)
    document.getElementById("btn-notif").addEventListener("click", initFirebaseMessagingRegistration);
  </script>
</body>
</html>
